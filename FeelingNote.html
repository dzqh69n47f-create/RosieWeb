<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿ƒæƒ…å†’éšªä»»å‹™</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ React å’Œ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- å¼•å…¥ Babel ç”¨æ–¼è§£æ JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- è¨­å®šå­—é«” -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        
        /* åˆ—å°å„ªåŒ–æ¨£å¼ */
        @media print {
          body * { visibility: hidden; }
          #certificate-area, #certificate-area * { visibility: visible; }
          #certificate-area {
            position: absolute; left: 0; top: 0; width: 100%;
            margin: 0; padding: 20px !important;
            border: 4px solid #8b5a2b !important;
            background-color: white !important;
          }
          * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
          .bg-decoration { display: none !important; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // --- åœ–ç¤ºå…ƒä»¶ (æ›¿ä»£ lucide-react) ---
        const IconWrapper = ({ children, size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const Sword = (props) => <IconWrapper {...props}><path d="M14.5 17.5L3 6V3h3l11.5 11.5"/><path d="m13 19 6-6"/><path d="M16 16l4 4"/><path d="M19 21l2-2"/></IconWrapper>;
        const Scroll = (props) => <IconWrapper {...props}><path d="M8 2h2l5 5v15H8a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2Z"/><path d="M8 2v5h5"/></IconWrapper>; // ä½¿ç”¨ FileText å½¢ç‹€ä½œç‚ºå·è»¸
        const Heart = (props) => <IconWrapper {...props}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5 4.5 1.5l.5.5.5-.5c1.5-1 2.74-1.5 4.5-1.5A5.5 5.5 0 0 0 22 8.5c0 2.29-1.51 4.04-3 5.5l-7 7-7-7Z"/></IconWrapper>;
        const Printer = (props) => <IconWrapper {...props}><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect width="12" height="8" x="6" y="14"/></IconWrapper>;
        const ArrowRight = (props) => <IconWrapper {...props}><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></IconWrapper>;
        const Save = (props) => <IconWrapper {...props}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></IconWrapper>;
        const User = (props) => <IconWrapper {...props}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></IconWrapper>;
        const Star = (props) => <IconWrapper {...props}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></IconWrapper>;
        const Edit3 = (props) => <IconWrapper {...props}><path d="M12 20h9"/><path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"/></IconWrapper>;
        const RotateCcw = (props) => <IconWrapper {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></IconWrapper>;
        const HelpCircle = (props) => <IconWrapper {...props}><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></IconWrapper>;
        const X = (props) => <IconWrapper {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconWrapper>;

        // --- ä¸»æ‡‰ç”¨ç¨‹å¼ ---
        function MoodQuest() {
            const [gameState, setGameState] = useState('landing');
            const [showResetConfirm, setShowResetConfirm] = useState(false);
            const [showPrintHelp, setShowPrintHelp] = useState(false);

            const [playerData, setPlayerData] = useState({
                name: '',
                mood: '', 
                moodCustom: '',
                weapon: '', 
                weaponCustom: '',
                lv50_reason: '',
                lv50_sensation: '',
                lv50_feeling: '',
                lv50_action: '',
                finalLevel: 1
            });

            const moodOptions = [
                { id: 'balloon', label: 'æ¼æ°£æ°£çƒ (è¦ºå¾—æ²’åŠ›æ°£)', icon: 'ğŸˆ' },
                { id: 'dog', label: 'æ·‹æ¿•å°ç‹— (è¦ºå¾—å†·å†·ã€å­¤å–®)', icon: 'ğŸ•' },
                { id: 'well', label: 'æ‰é€²æ·±äº• (è¦ºå¾—é»‘é»‘çš„)', icon: 'ğŸ•³ï¸' },
                { id: 'other', label: 'å…¶ä»–', icon: 'â“' }
            ];

            const weaponOptions = [
                { id: 'team', label: 'å¬å–šéšŠå‹ (æ‰¾è€å¸«/æœ‹å‹èªªè©±)', icon: 'ğŸ—£ï¸' },
                { id: 'shield', label: 'å¿ƒéˆè­·ç›¾ (æŠ±æŠ±ç©å¶/æ‰¾è§’è½ä¼‘æ¯)', icon: 'ğŸ§¸' },
                { id: 'music', label: 'é­”æ³•éŸ³æ¨‚ (è½å–œæ­¡çš„æ­Œ)', icon: 'ğŸµ' },
                { id: 'other', label: 'å…¶ä»–', icon: 'âœ¨' }
            ];

            const handleChange = (e) => {
                const { name, value } = e.target;
                setPlayerData(prev => ({ ...prev, [name]: value }));
            };

            const handleSelect = (category, value) => {
                setPlayerData(prev => ({ ...prev, [category]: value }));
            };

            const startGame = () => {
                if (!playerData.name.trim()) {
                    alert("å†’éšªè€…ï¼Œè«‹å…ˆå ±ä¸Šåä¾†ï¼");
                    return;
                }
                setGameState('zone1');
            };

            const finishLv1 = (continueToLv50) => {
                if (!playerData.mood || !playerData.weapon) {
                    alert("è«‹å…ˆå®Œæˆæƒæèˆ‡è£å‚™é¸æ“‡ï¼");
                    return;
                }
                if ((playerData.mood === 'other' && !playerData.moodCustom) || 
                    (playerData.weapon === 'other' && !playerData.weaponCustom)) {
                    alert("é¸æ“‡ã€Œå…¶ä»–ã€æ™‚ï¼Œè«‹è£œå……èªªæ˜å–”ï¼");
                    return;
                }

                if (continueToLv50) {
                    setGameState('zone2');
                } else {
                    setPlayerData(prev => ({ ...prev, finalLevel: 1 }));
                    setGameState('preview');
                }
            };

            const finishLv50 = () => {
                setPlayerData(prev => ({ ...prev, finalLevel: 50 }));
                setGameState('preview');
            };

            const getDisplayText = (category) => {
                const key = playerData[category];
                const customKey = category + 'Custom';
                
                if (key === 'other') return playerData[customKey];
                
                const options = category === 'mood' ? moodOptions : weaponOptions;
                const selected = options.find(opt => opt.id === key);
                return selected ? selected.label.split(' (')[0] + ' ' + selected.icon : ''; 
            };
            
            const getFullDisplayText = (category) => {
                const key = playerData[category];
                const customKey = category + 'Custom';
                
                if (key === 'other') return playerData[customKey];
                
                const options = category === 'mood' ? moodOptions : weaponOptions;
                const selected = options.find(opt => opt.id === key);
                return selected ? selected.label : '';
            };

            const handleSavePDF = () => {
                const printContent = document.getElementById('certificate-area');
                if (!printContent) return;

                const newWindow = window.open('', '_blank');
                if (!newWindow) {
                    alert("å½ˆå‡ºè¦–çª—è¢«å°é–ï¼Œè«‹å…è¨±æœ¬ç¶²ç«™é–‹å•Ÿè¦–çª—ä»¥é€²è¡Œå„²å­˜ã€‚");
                    return;
                }

                const htmlContent = `
                <!DOCTYPE html>
                <html lang="zh-TW">
                    <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>å†’éšªè€…å…¬æœƒä»»å‹™æ¿ - ${playerData.name}</title>
                    <script src="https://cdn.tailwindcss.com"></` + `script>
                    <style>
                        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');
                        body { 
                            font-family: 'Noto Sans TC', sans-serif; 
                            padding: 40px; 
                            background-color: white; 
                            display: flex;
                            justify-content: center;
                            -webkit-print-color-adjust: exact !important;
                            print-color-adjust: exact !important;
                        }
                        .print-wrapper { 
                            width: 100%;
                            max-width: 800px; 
                            display: flex;
                            flex-direction: column;
                        }
                        .teacher-credit {
                            text-align: center;
                            margin-top: 20px;
                            color: #8b5a2b;
                            font-size: 0.8rem;
                            opacity: 0.6;
                        }
                    </style>
                    </head>
                    <body>
                    <div class="print-wrapper">
                        ${printContent.innerHTML}
                        <div class="teacher-credit">é¡å¦‚è€å¸«ï½œç·¨åˆ¶</div>
                    </div>
                    <script>
                        setTimeout(() => {
                            window.print();
                        }, 800);
                    </` + `script>
                    </body>
                </html>
                `;
                
                newWindow.document.write(htmlContent);
                newWindow.document.close();

                setTimeout(() => {
                    if (gameState === 'preview') {
                        setShowPrintHelp(true);
                    }
                }, 2000);
            };

            const handleResetClick = () => {
                if (showResetConfirm) {
                    setGameState('landing');
                    setPlayerData({
                        name: '',
                        mood: '',
                        moodCustom: '',
                        weapon: '',
                        weaponCustom: '',
                        lv50_reason: '',
                        lv50_sensation: '',
                        lv50_feeling: '',
                        lv50_action: '',
                        finalLevel: 1
                    });
                    setShowResetConfirm(false);
                } else {
                    setShowResetConfirm(true);
                    setTimeout(() => setShowResetConfirm(false), 3000);
                }
            };

            return (
                <div className="min-h-screen bg-[#2c1810] p-4 md:p-8 font-sans text-[#4a3b32] flex flex-col">
                    <div className="fixed inset-0 pointer-events-none opacity-10 bg-decoration" style={{backgroundImage: 'url("data:image/svg+xml,%3Csvg width=\'60\' height=\'60\' viewBox=\'0 0 60 60\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cg fill=\'none\' fill-rule=\'evenodd\'%3E%3Cg fill=\'%23ffffff\' fill-opacity=\'1\'%3E%3Cpath d=\'M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z\'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")'}}></div>

                    <div className="text-center text-[#f3e5ab] opacity-60 text-sm font-medium tracking-widest mb-4 print:hidden relative z-10">
                        é¡å¦‚è€å¸«ï½œç·¨åˆ¶
                    </div>

                    <div className="flex-grow">
                        {gameState === 'landing' && (
                            <div className="max-w-2xl mx-auto mt-6 text-center animate-fade-in">
                                <div className="bg-[#f3e5ab] border-8 border-[#8b5a2b] p-8 rounded-lg shadow-2xl relative">
                                    <div className="absolute -top-6 left-1/2 transform -translate-x-1/2 bg-[#8b5a2b] text-[#f3e5ab] px-6 py-2 rounded-full border-4 border-[#d4af37] font-bold text-xl shadow-lg whitespace-nowrap">
                                        å†’éšªè€…å…¬æœƒç™»å…¥
                                    </div>
                                    <div className="mt-8 space-y-6">
                                        <div className="flex justify-center mb-6">
                                            <div className="w-24 h-24 bg-[#4a3b32] rounded-full flex items-center justify-center border-4 border-[#d4af37]">
                                                <Sword className="text-[#f3e5ab]" size={48} />
                                            </div>
                                        </div>
                                        <h1 className="text-3xl font-bold text-[#5c4033] mb-2">å¿ƒæƒ…å°æ—¥è¨˜ä»»å‹™</h1>
                                        <p className="text-[#8b5a2b] mb-6">æº–å‚™å¥½å°æŠ—ã€Œå¤±è½æ€ªç¸ã€äº†å—ï¼Ÿè«‹è¼¸å…¥ä½ çš„å†’éšªè€… IDã€‚</p>
                                        <div className="flex flex-col items-center gap-4">
                                            <input
                                                type="text"
                                                name="name"
                                                placeholder="è«‹è¼¸å…¥ä½ çš„åå­—..."
                                                value={playerData.name}
                                                onChange={handleChange}
                                                className="w-full max-w-md px-6 py-3 text-xl text-center bg-white border-4 border-[#8b5a2b] rounded-lg focus:outline-none focus:border-[#d4af37] placeholder-[#a08c7a]"
                                            />
                                            <button onClick={startGame} type="button" className="group relative inline-flex items-center justify-center px-8 py-3 font-bold text-white transition-all duration-200 bg-[#c0392b] border-b-4 border-[#8e281d] hover:border-b-0 hover:translate-y-1 rounded-lg focus:outline-none ring-offset-2 focus:ring-2 ring-[#c0392b]">
                                                <span className="mr-2 text-xl">é–‹å§‹å†’éšª</span>
                                                <ArrowRight size={24} className="group-hover:translate-x-1 transition-transform" />
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {(gameState === 'zone1' || gameState === 'zone2') && (
                            <div className="max-w-4xl mx-auto animate-fade-in">
                                <div className="bg-[#4a3b32] text-[#f3e5ab] p-4 rounded-t-xl border-x-4 border-t-4 border-[#8b5a2b] flex justify-between items-center shadow-lg relative z-10">
                                    <div className="flex items-center gap-3">
                                        <div className="w-10 h-10 bg-[#8b5a2b] rounded flex items-center justify-center border-2 border-[#d4af37]">
                                            <User size={24} />
                                        </div>
                                        <div>
                                            <p className="text-xs text-[#d4af37]">å†’éšªè€…</p>
                                            <p className="font-bold text-lg">{playerData.name}</p>
                                        </div>
                                    </div>
                                    <div className="bg-[#2c1810] px-4 py-1 rounded-full border border-[#d4af37]">
                                        <span className="text-[#d4af37] font-bold">LV. {gameState === 'zone1' ? '1' : '50'}</span>
                                    </div>
                                </div>

                                <div className="bg-[#fdf6e3] border-x-8 border-b-8 border-[#8b5a2b] p-6 md:p-8 rounded-b-xl shadow-2xl relative min-h-[500px]">
                                    {gameState === 'zone1' && (
                                        <div className="space-y-8 relative z-10">
                                            <div className="bg-[#ffecd1] border-l-8 border-[#e67e22] p-4 rounded shadow-sm">
                                                <h2 className="text-2xl font-bold text-[#d35400] flex items-center gap-2 mb-2">
                                                    <span className="text-3xl">â—†</span> Zone 1: æƒæèˆ‡è£å‚™
                                                </h2>
                                                <p className="text-[#7f8c8d] font-bold">é©åˆç­‰ç´š Lv.1 | ä»»å‹™ç›®æ¨™ï¼šè¾¨è­˜æƒ…ç·’èˆ‡é¸æ“‡å°ç­–</p>
                                            </div>

                                            <div className="grid md:grid-cols-2 gap-8">
                                                <div className="bg-white/50 p-6 rounded-lg border-2 border-[#e6e6e6] hover:border-[#3498db] transition-colors">
                                                    <h3 className="font-bold text-xl mb-4 text-[#2c3e50] flex items-center gap-2">
                                                        1. é­é‡æ€ªç¸ (æƒæå¿ƒæƒ…)
                                                    </h3>
                                                    <p className="mb-4 text-[#555]">ç•¶ã€Œå¤±è½ã€å‡ºç¾æ™‚ï¼Œæˆ‘è¦ºå¾—è‡ªå·±åƒ...</p>
                                                    <div className="space-y-3">
                                                        {moodOptions.map((opt) => (
                                                            <label key={opt.id} className={`flex items-center p-3 rounded-lg border-2 cursor-pointer transition-all ${playerData.mood === opt.id ? 'bg-[#e8f6f3] border-[#1abc9c] shadow-md transform scale-[1.02]' : 'bg-white border-transparent hover:bg-gray-50'}`}>
                                                                <input type="radio" name="mood" className="w-5 h-5 text-[#1abc9c]" checked={playerData.mood === opt.id} onChange={() => handleSelect('mood', opt.id)} />
                                                                <span className="ml-3 font-medium text-lg">{opt.icon} {opt.label}</span>
                                                            </label>
                                                        ))}
                                                        {playerData.mood === 'other' && (
                                                            <input type="text" name="moodCustom" placeholder="è«‹æè¿°åƒä»€éº¼..." value={playerData.moodCustom} onChange={handleChange} className="w-full mt-2 p-2 border-b-2 border-[#1abc9c] bg-transparent focus:outline-none" autoFocus />
                                                        )}
                                                    </div>
                                                </div>

                                                <div className="bg-white/50 p-6 rounded-lg border-2 border-[#e6e6e6] hover:border-[#e74c3c] transition-colors">
                                                    <h3 className="font-bold text-xl mb-4 text-[#2c3e50] flex items-center gap-2">
                                                        2. é¸æ“‡æ­¦å™¨ (é˜²ç¦¦é“å…·)
                                                    </h3>
                                                    <p className="mb-4 text-[#555]">é€™æ™‚å€™ï¼Œæˆ‘å¯ä»¥ä½¿ç”¨ä»€éº¼çµ•æ‹›ï¼Ÿ</p>
                                                    <div className="space-y-3">
                                                        {weaponOptions.map((opt) => (
                                                            <label key={opt.id} className={`flex items-center p-3 rounded-lg border-2 cursor-pointer transition-all ${playerData.weapon === opt.id ? 'bg-[#fdedec] border-[#e74c3c] shadow-md transform scale-[1.02]' : 'bg-white border-transparent hover:bg-gray-50'}`}>
                                                                <input type="radio" name="weapon" className="w-5 h-5 text-[#e74c3c]" checked={playerData.weapon === opt.id} onChange={() => handleSelect('weapon', opt.id)} />
                                                                <span className="ml-3 font-medium text-lg">{opt.icon} {opt.label}</span>
                                                            </label>
                                                        ))}
                                                        {playerData.weapon === 'other' && (
                                                            <input type="text" name="weaponCustom" placeholder="è«‹å¯«ä¸‹ä½ çš„çµ•æ‹›..." value={playerData.weaponCustom} onChange={handleChange} className="w-full mt-2 p-2 border-b-2 border-[#e74c3c] bg-transparent focus:outline-none" autoFocus />
                                                        )}
                                                    </div>
                                                </div>
                                            </div>

                                            <div className="flex flex-col md:flex-row gap-4 justify-center mt-8 pt-6 border-t-2 border-[#dcdcdc] border-dashed">
                                                <button onClick={() => finishLv1(false)} type="button" className="px-6 py-3 bg-[#95a5a6] hover:bg-[#7f8c8d] text-white font-bold rounded-lg shadow-md transition-all flex items-center justify-center gap-2">
                                                    <Save size={20} /> å®Œæˆ Lv.1 ä»»å‹™ (é è¦½åˆ—å°)
                                                </button>
                                                <button onClick={() => finishLv1(true)} type="button" className="px-6 py-3 bg-[#2ecc71] hover:bg-[#27ae60] text-white font-bold rounded-lg shadow-md border-b-4 border-[#1e8449] active:border-b-0 active:translate-y-1 transition-all flex items-center justify-center gap-2">
                                                    <Star size={20} className="animate-spin-slow" /> å‡ç´šæŒ‘æˆ° Lv.50 (æˆ°é¬¥æ—¥èªŒ)
                                                </button>
                                            </div>
                                        </div>
                                    )}

                                    {gameState === 'zone2' && (
                                        <div className="space-y-8 relative z-10">
                                            <div className="bg-[#d6eaf8] border-l-8 border-[#3498db] p-4 rounded shadow-sm">
                                                <h2 className="text-2xl font-bold text-[#2980b9] flex items-center gap-2 mb-2">
                                                    <span className="text-3xl">â—†</span> Zone 2: æˆ°é¬¥æ—¥èªŒ
                                                </h2>
                                                <p className="text-[#7f8c8d] font-bold">é©åˆç­‰ç´š Lv.50 | ä»»å‹™ç›®æ¨™ï¼šæ•´åˆç¶“é©—ï¼Œå®Œæˆå¥å­</p>
                                            </div>

                                            <div className="bg-[#fff9c4] p-4 rounded-lg border border-[#f1c40f] text-[#f39c12] font-bold flex items-center gap-3">
                                                <div className="bg-[#f1c40f] text-white p-2 rounded-full"><Edit3 size={20}/></div>
                                                æç¤ºï¼šè«‹åƒè€ƒä½ åœ¨ Zone 1 çš„é¸æ“‡ï¼ŒæŠŠå¥å­è®Šå®Œæ•´ï¼
                                            </div>

                                            <div className="space-y-6 bg-white/60 p-6 rounded-lg border-2 border-[#8b5a2b]">
                                                <div className="space-y-2">
                                                    <label className="block text-lg font-bold text-[#5c4033]">1. äº‹ä»¶ç´€éŒ„ï¼š</label>
                                                    <div className="flex flex-wrap items-baseline gap-2 text-lg leading-loose">
                                                        <span>æœ‰ä¸€å¤©ï¼Œå› ç‚º</span>
                                                        <input type="text" name="lv50_reason" value={playerData.lv50_reason} onChange={handleChange} placeholder="ä¾‹å¦‚ï¼šå¼„ä¸Ÿæ±è¥¿ / è¢«ç½µ" className="flex-1 min-w-[200px] border-b-2 border-dashed border-[#8b5a2b] bg-transparent px-2 py-1 focus:border-solid focus:outline-none placeholder-gray-400 font-handwriting" />
                                                        <span>ï¼Œæˆ‘è¦ºå¾—å¿ƒæƒ…å¾ˆå¤±è½ã€‚</span>
                                                    </div>
                                                </div>

                                                <div className="space-y-2">
                                                    <label className="block text-lg font-bold text-[#5c4033]">2. ç‹€æ…‹åˆ†æï¼š</label>
                                                    <div className="flex flex-wrap items-baseline gap-2 text-lg leading-loose">
                                                        <span>é‚£æ™‚å€™ï¼Œæˆ‘çš„èº«é«”æ„Ÿè¦º</span>
                                                        <input type="text" name="lv50_sensation" value={playerData.lv50_sensation} onChange={handleChange} placeholder="ä¾‹å¦‚ï¼šèƒ¸å£æ‚¶æ‚¶çš„ / æƒ³å“­" className="flex-1 min-w-[200px] border-b-2 border-dashed border-[#8b5a2b] bg-transparent px-2 py-1 focus:border-solid focus:outline-none placeholder-gray-400 font-handwriting" />
                                                        <span>ï¼Œ</span>
                                                    </div>
                                                    <div className="flex flex-wrap items-baseline gap-2 text-lg leading-loose">
                                                        <span>æˆ‘è¦ºå¾—è‡ªå·±å°±åƒ</span>
                                                        <span className="inline-block px-3 py-1 bg-[#2ecc71]/20 text-[#27ae60] rounded font-bold border border-[#2ecc71]">{getFullDisplayText('mood')}</span>
                                                        <span>ä¸€æ¨£ï¼Œè¦ºå¾—</span>
                                                        <input type="text" name="lv50_feeling" value={playerData.lv50_feeling} onChange={handleChange} placeholder="è¦ºå¾—æ€éº¼æ¨£..." className="flex-1 min-w-[200px] border-b-2 border-dashed border-[#8b5a2b] bg-transparent px-2 py-1 focus:border-solid focus:outline-none placeholder-gray-400 font-handwriting" />
                                                        <span>ã€‚</span>
                                                    </div>
                                                </div>

                                                <div className="space-y-2">
                                                    <label className="block text-lg font-bold text-[#5c4033]">3. è¡Œå‹•æ–¹æ¡ˆï¼š</label>
                                                    <div className="flex flex-wrap items-baseline gap-2 text-lg leading-loose">
                                                        <span>å¾Œä¾†ï¼Œæˆ‘è©¦è‘—</span>
                                                        <div className="flex-1 flex gap-2">
                                                            <span className="inline-block px-3 py-1 bg-[#e74c3c]/20 text-[#c0392b] rounded font-bold border border-[#e74c3c] whitespace-nowrap">{getFullDisplayText('weapon')}</span>
                                                            <input type="text" name="lv50_action" value={playerData.lv50_action} onChange={handleChange} placeholder="é‚„æœ‰åšä»€éº¼å—ï¼Ÿ" className="flex-1 min-w-[150px] border-b-2 border-dashed border-[#8b5a2b] bg-transparent px-2 py-1 focus:border-solid focus:outline-none placeholder-gray-400 font-handwriting" />
                                                        </div>
                                                        <span>ï¼Œå¿ƒæƒ…å°±å¥½ä¸€é»äº†ã€‚</span>
                                                    </div>
                                                </div>
                                            </div>

                                            <div className="flex justify-center gap-4 mt-8">
                                                <button onClick={() => setGameState('zone1')} type="button" className="px-4 py-2 text-[#7f8c8d] underline hover:text-[#2c3e50]">å›ä¸Šä¸€é ä¿®æ”¹</button>
                                                <button onClick={finishLv50} type="button" className="px-8 py-3 bg-[#e67e22] hover:bg-[#d35400] text-white font-bold rounded-lg shadow-md border-b-4 border-[#a04000] active:border-b-0 active:translate-y-1 transition-all flex items-center justify-center gap-2 text-xl">
                                                    <Scroll size={24} /> å®Œæˆä»»å‹™ (é ˜å–æ—¥èªŒ)
                                                </button>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {gameState === 'preview' && (
                            <div className="max-w-4xl mx-auto animate-fade-in print:w-full print:max-w-none">
                                <div id="certificate-area" className="bg-[#fdf6e3] text-[#4a3b32] p-8 rounded-xl shadow-2xl border-[12px] border-[#8b5a2b] relative print:shadow-none print:border-[4px] print:p-8 print:mx-0">
                                    <div className="absolute top-0 left-0 w-16 h-16 border-t-4 border-l-4 border-[#d4af37] -mt-3 -ml-3"></div>
                                    <div className="absolute top-0 right-0 w-16 h-16 border-t-4 border-r-4 border-[#d4af37] -mt-3 -mr-3"></div>
                                    <div className="absolute bottom-0 left-0 w-16 h-16 border-b-4 border-l-4 border-[#d4af37] -mb-3 -ml-3"></div>
                                    <div className="absolute bottom-0 right-0 w-16 h-16 border-b-4 border-r-4 border-[#d4af37] -mb-3 -mr-3"></div>

                                    <div className="text-center mb-8 border-b-4 border-[#8b5a2b] pb-4 border-double">
                                        <h1 className="text-4xl font-extrabold text-[#5c4033] mb-2 tracking-widest">ç©å®¶å…¬æœƒä»»å‹™æ¿</h1>
                                        <p className="text-xl font-bold text-[#8b5a2b]">ä»»å‹™ä¸‰ï¼šå¿ƒæƒ…å°æ—¥è¨˜ (Mini Writing)</p>
                                    </div>

                                    <div className="mb-8 flex items-end gap-2 text-xl font-bold">
                                        <span>å†’éšªè€… ID (å§“å)ï¼š</span>
                                        <span className="flex-1 border-b-2 border-[#4a3b32] px-2 text-2xl font-handwriting">{playerData.name}</span>
                                        <span className="text-sm text-gray-500">Lv.{playerData.finalLevel}</span>
                                    </div>

                                    <div className="mb-6">
                                        <p className="font-bold text-lg mb-2">ä»»å‹™ç›®æ¨™ï¼šç´€éŒ„ä¸€æ¬¡å°æŠ—ã€Œå¤±è½æ€ªç¸ã€çš„æˆ°é¬¥éç¨‹ã€‚</p>
                                    </div>

                                    <div className="grid gap-8">
                                        <div className="bg-[#fffdf5] border-2 border-[#d4af37] p-6 rounded-lg relative">
                                            <div className="absolute -top-4 left-4 bg-[#d4af37] text-white px-4 py-1 rounded font-bold shadow">Zone 1: æƒæèˆ‡è£å‚™</div>
                                            <div className="grid grid-cols-2 gap-6 mt-2">
                                                <div>
                                                    <h3 className="font-bold text-[#e67e22] mb-3">1. é­é‡æ€ªç¸ (æƒæå¿ƒæƒ…)</h3>
                                                    <div className="bg-white p-3 rounded border border-gray-200">
                                                        ç•¶ã€Œå¤±è½ã€å‡ºç¾æ™‚ï¼Œæˆ‘è¦ºå¾—è‡ªå·±åƒ... <br/>
                                                        <span className="text-2xl font-bold text-[#2c3e50] mt-2 block">{getDisplayText('mood')}</span>
                                                    </div>
                                                </div>
                                                <div>
                                                    <h3 className="font-bold text-[#e74c3c] mb-3">2. é¸æ“‡æ­¦å™¨ (é˜²ç¦¦é“å…·)</h3>
                                                    <div className="bg-white p-3 rounded border border-gray-200">
                                                        é€™æ™‚å€™ï¼Œæˆ‘å¯ä»¥ä½¿ç”¨... <br/>
                                                        <span className="text-2xl font-bold text-[#2c3e50] mt-2 block">{getDisplayText('weapon')}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        {playerData.finalLevel >= 50 && (
                                            <div className="bg-[#f0f8ff] border-2 border-[#3498db] p-6 rounded-lg relative">
                                                <div className="absolute -top-4 left-4 bg-[#3498db] text-white px-4 py-1 rounded font-bold shadow">Zone 2: æˆ°é¬¥æ—¥èªŒ</div>
                                                <div className="space-y-4 mt-2 text-lg leading-relaxed">
                                                    <div className="p-4 bg-white rounded border border-blue-100 shadow-sm">
                                                        <p>
                                                            <span className="font-bold text-gray-500 mr-2">1. äº‹ä»¶ï¼š</span>
                                                            æœ‰ä¸€å¤©ï¼Œå› ç‚º <span className="font-bold text-[#2980b9] underline decoration-wavy">{playerData.lv50_reason || '_______'}</span>ï¼Œæˆ‘è¦ºå¾—å¿ƒæƒ…å¾ˆå¤±è½ã€‚
                                                        </p>
                                                    </div>
                                                    <div className="p-4 bg-white rounded border border-blue-100 shadow-sm">
                                                        <p>
                                                            <span className="font-bold text-gray-500 mr-2">2. æ„Ÿè¦ºï¼š</span>
                                                            é‚£æ™‚å€™ï¼Œæˆ‘çš„èº«é«”æ„Ÿè¦º <span className="font-bold text-[#2980b9] underline decoration-wavy">{playerData.lv50_sensation || '_______'}</span>ï¼Œæˆ‘è¦ºå¾—è‡ªå·±å°±åƒ <span className="font-bold text-[#2980b9] bg-blue-50 px-2 rounded">{getDisplayText('mood')}</span> ä¸€æ¨£ï¼Œè¦ºå¾— <span className="font-bold text-[#2980b9] underline decoration-wavy">{playerData.lv50_feeling || '_______'}</span>ã€‚
                                                        </p>
                                                    </div>
                                                    <div className="p-4 bg-white rounded border border-blue-100 shadow-sm">
                                                        <p>
                                                            <span className="font-bold text-gray-500 mr-2">3. è¡Œå‹•ï¼š</span>
                                                            å¾Œä¾†ï¼Œæˆ‘è©¦è‘— <span className="font-bold text-[#2980b9] bg-blue-50 px-2 rounded">{getDisplayText('weapon')}</span> {playerData.lv50_action && <span className="font-bold text-[#2980b9] underline decoration-wavy">ï¼Œ{playerData.lv50_action}</span>}ï¼Œå¿ƒæƒ…å°±å¥½ä¸€é»äº†ã€‚
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        )}

                                        <div className="text-center mt-4 text-[#8b5a2b] font-bold border-t-2 border-[#8b5a2b] pt-4 border-dashed">
                                            <div className="flex justify-center gap-2 items-center mb-2">
                                                <Heart className="text-[#e74c3c] fill-current" />
                                                <span>å…¬æœƒé•·è©•èªï¼šåšå¾—å¥½ï¼æ¯ä¸€æ¬¡ç´€éŒ„éƒ½æ˜¯æˆé•·çš„é¤Šåˆ†ã€‚</span>
                                                <Heart className="text-[#e74c3c] fill-current" />
                                            </div>
                                            <div className="text-sm text-gray-400">Mission Complete Date: {new Date().toLocaleDateString()}</div>
                                        </div>
                                    </div>
                                </div>

                                {showPrintHelp && (
                                    <div className="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg text-sm text-blue-900 print:hidden relative animate-fade-in">
                                        <button onClick={() => setShowPrintHelp(false)} className="absolute top-2 right-2 text-blue-400 hover:text-blue-700"><X size={18} /></button>
                                        <h4 className="font-bold text-lg mb-2 flex items-center gap-2">ğŸ“± æŒ‰éˆ•æ²’æœ‰åæ‡‰ï¼Ÿ</h4>
                                        <p className="mb-2">å¦‚æœä¸‹æ–¹çš„æŒ‰éˆ•è¢«æ“‹ä½ï¼Œè«‹å˜—è©¦ï¼š</p>
                                        <ul className="list-disc list-inside space-y-1 ml-1 text-gray-700">
                                            <li>æª¢æŸ¥ç€è¦½å™¨æ˜¯å¦å°é–äº†å½ˆå‡ºè¦–çª—ã€‚</li>
                                            <li>ä½¿ç”¨å¹³æ¿ç€è¦½å™¨å…§å»ºçš„<span className="font-bold">ã€Œåˆ†äº«ã€</span> â¤ <span className="font-bold">ã€Œåˆ—å°ã€</span>åŠŸèƒ½ã€‚</li>
                                        </ul>
                                    </div>
                                )}

                                <div className="mt-8 flex flex-col md:flex-row justify-between items-center print:hidden bg-white p-4 rounded-lg shadow-lg border border-gray-200 gap-4">
                                    <button onClick={handleResetClick} type="button" className={`font-bold px-4 py-2 rounded border transition-all flex items-center gap-2 ${showResetConfirm ? 'bg-red-500 text-white hover:bg-red-600' : 'text-gray-500 hover:text-red-500 border-transparent hover:border-red-200'}`}>
                                        <RotateCcw size={18} />
                                        {showResetConfirm ? "ç¢ºå®šè¦é‡ä¾†ï¼Ÿ" : "é‡æ–°é–‹å§‹"}
                                    </button>

                                    <div className="flex flex-col md:flex-row gap-3 items-center w-full md:w-auto">
                                        {playerData.finalLevel === 1 && (
                                            <button onClick={() => setGameState('zone2')} type="button" className="bg-[#2ecc71] hover:bg-[#27ae60] text-white px-4 py-2 rounded font-bold shadow transition-colors w-full md:w-auto">
                                                ç¹¼çºŒæŒ‘æˆ° Lv.50
                                            </button>
                                        )}
                                        
                                        <div className="flex flex-col md:flex-row items-center gap-3 w-full md:w-auto">
                                            <button onClick={handleSavePDF} type="button" className="bg-[#3498db] hover:bg-[#2980b9] text-white px-5 py-2 rounded font-bold shadow-lg flex items-center justify-center gap-2 w-full md:w-auto whitespace-nowrap">
                                                <Printer size={20} /> å„²å­˜æˆ PDF / åˆ—å°
                                            </button>
                                            <button onClick={() => setShowPrintHelp(!showPrintHelp)} className="text-gray-400 hover:text-blue-500" title="åˆ—å°èªªæ˜">
                                                <HelpCircle size={20} />
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>

                    <div className="text-center text-[#f3e5ab] opacity-60 text-sm font-medium tracking-widest mt-8 print:hidden relative z-10">
                        é¡å¦‚è€å¸«ï½œç·¨åˆ¶
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MoodQuest />);
    </script>
</body>
</html>