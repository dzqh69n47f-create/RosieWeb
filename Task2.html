<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»»å‹™äºŒï¼šæƒ…ç·’åµæ¢äº‹å‹™æ‰€ (Macç‰ˆ)</title>
    <!-- å¼•å…¥ Tailwind CSS (å¿«é€Ÿæ’ç‰ˆ) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Mac å­—é«”å„ªåŒ– */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans TC", sans-serif; }
        
        /* å‹•ç•«è¨­å®š */
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .slide-in { animation: slideIn 0.5s ease-out forwards; }
        .zoom-in { animation: zoomIn 0.3s ease-out forwards; }
        .pulse-slow { animation: pulse 3s infinite; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes zoomIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        /* éš±è—æ²è»¸ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="min-h-screen bg-slate-900 text-slate-200 flex justify-center items-center p-4 md:p-8 selection:bg-cyan-500 selection:text-white">

    <!-- ä¸»è£ç½®å®¹å™¨ -->
    <div class="w-full max-w-4xl bg-slate-800 rounded-3xl border-4 border-slate-700 shadow-2xl overflow-hidden relative flex flex-col min-h-[600px]">
        
        <!-- é ‚éƒ¨ç‹€æ…‹åˆ— -->
        <div class="bg-slate-900 p-4 border-b border-slate-700 flex justify-between items-center z-10">
            <div class="flex items-center gap-3">
                <div class="w-3 h-3 rounded-full bg-red-500 animate-pulse"></div>
                <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                <div class="w-3 h-3 rounded-full bg-green-500"></div>
                <span class="ml-4 font-mono text-cyan-400 font-bold tracking-widest text-sm md:text-base">
                    DETECTIVE_OS v2.0
                </span>
            </div>
            <div class="flex items-center gap-2 text-xs md:text-sm font-bold text-slate-400">
                 <!-- ID Icon -->
                 <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12C2 12 5 2 12 2C19 2 22 12 22 12"/><path d="M12 2V12"/><path d="M12 22C12 22 19 12 19 12"/><path d="M12 22C12 22 5 12 5 12"/><path d="M12 22V12"/></svg>
                 <span>ID: STUDENT_01</span>
            </div>
        </div>

        <!-- å‹•æ…‹å…§å®¹å€ -->
        <div id="game-content" class="flex-1 p-6 md:p-10 relative overflow-hidden">
            <!-- é€™è£¡çš„å…§å®¹æœƒç”± JS æ›¿æ› -->
        </div>

        <!-- èƒŒæ™¯ç¶²æ ¼ -->
        <div class="absolute inset-0 opacity-5 pointer-events-none z-0" 
             style="background-image: radial-gradient(#22d3ee 1px, transparent 1px); background-size: 20px 20px;">
        </div>

        <!-- æç¤ºè¨Šæ¯ (Toast) -->
        <div id="toast" class="absolute bottom-8 left-1/2 -translate-x-1/2 px-6 py-4 rounded-xl shadow-2xl flex items-center gap-3 transition-all duration-300 opacity-0 translate-y-10 z-50 min-w-[300px] justify-center pointer-events-none">
            <div id="toast-icon"></div>
            <span id="toast-msg" class="font-bold"></span>
        </div>
    </div>

    <!-- JavaScript é‚è¼¯ -->
    <script>
        // --- 1. è³‡æ–™èˆ‡ç‹€æ…‹ ---
        let state = {
            stage: 'intro', // intro, evidence, motive, scan, tactics, report
            matchedEvidence: false,
            selectedMotive: null,
            bodySymptoms: [],
            selectedTactics: []
        };

        // SVG Icons (å‘é‡åœ–ç¤º)
        const icons = {
            search: `<svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>`,
            siren: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 18v-6a5 5 0 1 1 10 0v6"/><path d="M5 21a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2"/><path d="M12 3a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z"/><circle cx="12" cy="14" r="3"/></svg>`,
            arrowRight: `<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>`,
            check: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>`,
            alert: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>`,
            fileText: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></svg>`,
            activity: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>`,
            shield: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>`,
            refresh: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M3 21v-5h5"/></svg>`
        };

        // --- 2. æ ¸å¿ƒåŠŸèƒ½ ---

        function showFeedback(type, message) {
            const toast = document.getElementById('toast');
            const icon = document.getElementById('toast-icon');
            const msg = document.getElementById('toast-msg');
            
            toast.className = `absolute bottom-8 left-1/2 -translate-x-1/2 px-6 py-4 rounded-xl shadow-2xl flex items-center gap-3 transition-all duration-300 z-50 min-w-[300px] justify-center ${type === 'success' ? 'bg-green-500 text-white' : 'bg-red-500 text-white'} opacity-100 translate-y-0`;
            icon.innerHTML = type === 'success' ? icons.check : icons.alert;
            msg.textContent = message;

            setTimeout(() => {
                toast.classList.add('opacity-0', 'translate-y-10');
            }, 2500);
        }

        function setStage(newStage) {
            state.stage = newStage;
            render();
        }

        function handleEvidenceMatch(item) {
            if (item === 'tire') {
                state.matchedEvidence = true;
                render(); // Re-render to show success state
                showFeedback('success', 'é…å°æˆåŠŸï¼å¤±è½çš„æ„Ÿè¦ºå°±åƒæ²’æ°£çš„è¼ªèƒï¼Œå‹•å½ˆä¸å¾—ã€‚');
                setTimeout(() => setStage('motive'), 2000);
            } else {
                showFeedback('error', 'å†æƒ³ä¸€ä¸‹... é€™å€‹æ¯”å–»å¥½åƒä¸å¤ªç¬¦åˆã€Œå¤±è½ã€é‚£ç¨®ç„¡åŠ›çš„æ„Ÿè¦ºï¼Ÿ');
            }
        }

        function handleMotiveSubmit() {
            if (state.selectedMotive === 'love') {
                showFeedback('success', 'åˆ†ææ­£ç¢ºï¼å°æ¨‚åœ¨ä¹çš„æ˜¯åª½åª½çš„æ„›èˆ‡å…¬å¹³ã€‚');
                setTimeout(() => setStage('scan'), 2000);
            } else {
                showFeedback('error', 'çœŸçš„æ˜¯å› ç‚ºç©å…·å—ï¼Ÿé‚„æ˜¯æœ‰æ›´æ·±å±¤çš„åŸå› å‘¢ï¼Ÿ');
            }
        }

        function toggleBodySymptom(id) {
            const index = state.bodySymptoms.indexOf(id);
            if (index > -1) {
                state.bodySymptoms.splice(index, 1);
            } else {
                state.bodySymptoms.push(id);
            }
            render();
        }

        function handleScanSubmit() {
            const isCorrect = state.bodySymptoms.includes('heavy') && state.bodySymptoms.includes('sore') && !state.bodySymptoms.includes('hot');
            
            if (isCorrect) {
                showFeedback('success', 'æƒæå®Œæˆï¼é€™äº›éƒ½æ˜¯å¤±è½æ™‚å¸¸è¦‹çš„èº«é«”åæ‡‰ã€‚');
                setTimeout(() => setStage('tactics'), 2000);
            } else if (state.bodySymptoms.includes('hot')) {
                showFeedback('error', 'ã€Œèº«é«”åƒç«åœ¨ç‡’ã€é€šå¸¸æ˜¯ã€Œç”Ÿæ°£ã€å–”ï¼å¤±è½é€šå¸¸æ¯”è¼ƒåƒæ²’åŠ›æ°£ã€‚');
            } else {
                showFeedback('error', 'é‚„æœ‰å…¶ä»–çš„åæ‡‰å–”ï¼å†ä»”ç´°æ„Ÿè¦ºä¸€ä¸‹èº«é«”... (æç¤ºï¼šçœ¼ç›ã€èƒ¸å£)');
            }
        }

        function toggleTactic(id) {
            const index = state.selectedTactics.indexOf(id);
            if (index > -1) {
                state.selectedTactics.splice(index, 1);
            } else {
                state.selectedTactics.push(id);
            }
            render();
        }

        function handleTacticsSubmit() {
            const hasBad = state.selectedTactics.includes('pretend');
            const hasGood = state.selectedTactics.includes('hide') || state.selectedTactics.includes('talk') || state.selectedTactics.includes('cry');
            
            if (!hasBad && hasGood) {
                showFeedback('success', 'æˆ°è¡“åˆ¶å®šæˆåŠŸï¼æ¥ç´æƒ…ç·’ã€å°‹æ±‚æ”¯æŒéƒ½æ˜¯å¥½æ–¹æ³•ã€‚');
                setTimeout(() => setStage('report'), 2000);
            } else if (hasBad) {
                showFeedback('error', 'ã€Œå‡è£æ²’äº‹ã€å¯èƒ½æœƒè®“å¿ƒè£¡çš„é›¨ä¸‹å¾—æ›´ä¹…å–”... è©¦è‘—é¢å°å®ƒå§ï¼');
            } else {
                showFeedback('error', 'è«‹è‡³å°‘é¸æ“‡ä¸€ç¨®èƒ½è®“å¿ƒè£¡èˆ’æœä¸€é»çš„æ–¹æ³•ã€‚');
            }
        }

        function restartGame() {
            state = {
                stage: 'intro',
                matchedEvidence: false,
                selectedMotive: null,
                bodySymptoms: [],
                selectedTactics: []
            };
            render();
        }

        // --- 3. æ¸²æŸ“è¦–åœ– (Render) ---

        function render() {
            const container = document.getElementById('game-content');
            container.innerHTML = ''; // æ¸…ç©º

            if (state.stage === 'intro') renderIntro(container);
            else if (state.stage === 'evidence') renderEvidence(container);
            else if (state.stage === 'motive') renderMotive(container);
            else if (state.stage === 'scan') renderScan(container);
            else if (state.stage === 'tactics') renderTactics(container);
            else if (state.stage === 'report') renderReport(container);
        }

        function renderIntro(container) {
            const div = document.createElement('div');
            div.className = 'h-full flex flex-col items-center justify-center text-center zoom-in';
            div.innerHTML = `
                <div class="w-24 h-24 bg-cyan-900/30 rounded-full flex items-center justify-center mb-6 border-2 border-cyan-500 shadow-[0_0_20px_rgba(6,182,212,0.3)] text-cyan-400">
                    ${icons.search}
                </div>
                <h1 class="text-3xl md:text-4xl font-black text-white mb-2 tracking-tight">ä»»å‹™äºŒï¼šåµæ¢å ±å‘Š</h1>
                <p class="text-slate-400 text-lg mb-8 max-w-lg">æœ‰ä¸€æ¨ã€Œæƒ…ç·’æ¡ˆä»¶ã€ç™¼ç”Ÿäº†ã€‚æ ¹æ“šä½ å‰›å‰›æ”¶é›†åˆ°çš„ç·šç´¢ï¼Œæˆ‘å€‘éœ€è¦ä½ å”åŠ©åˆ†æç¾å ´ï¼Œé‚„åŸçœŸç›¸ã€‚</p>
                <button onclick="setStage('evidence')" class="group px-8 py-4 bg-cyan-600 hover:bg-cyan-500 text-white font-bold rounded-xl transition-all shadow-lg hover:shadow-cyan-500/25 flex items-center gap-2">
                    ${icons.siren} é–‹å§‹èª¿æŸ¥
                </button>
            `;
            container.appendChild(div);
        }

        function renderEvidence(container) {
            const div = document.createElement('div');
            div.className = 'h-full flex flex-col slide-in';
            
            // å·¦å´å¡ç‰‡
            const leftCard = `
                <div class="w-full md:w-1/3">
                    <div class="w-full p-6 bg-slate-700/50 border-2 border-blue-400 rounded-2xl flex flex-col items-center gap-3 shadow-[0_0_15px_rgba(59,130,246,0.2)]">
                        <div class="text-4xl">ğŸ’”ğŸŒ§ï¸</div>
                        <div class="font-bold text-lg text-blue-200">å¤±è½çš„å¿ƒæƒ…</div>
                        <div class="text-xs text-blue-300/50">EVIDENCE A</div>
                    </div>
                    <div class="hidden md:flex justify-center mt-2"><div class="w-1 h-8 bg-blue-400/30"></div></div>
                </div>
            `;

            // å³å´é¸é …
            const options = [
                { id: 'ball', text: 'å……æ»¿æ°£çš„ç±ƒçƒ', icon: 'ğŸ€' },
                { id: 'tire', text: 'æ¼æ°£çš„è¼ªèƒ', icon: 'ğŸš™' },
                { id: 'balloon', text: 'é£„èµ°çš„æ°£çƒ', icon: 'ğŸˆ' }
            ].map(item => {
                const isMatch = state.matchedEvidence && item.id === 'tire';
                const baseClass = "w-full p-4 rounded-xl border-2 text-left flex items-center gap-4 transition-all mb-4";
                const activeClass = isMatch ? "bg-green-900/30 border-green-500 text-green-100 shadow-[0_0_15px_rgba(34,197,94,0.3)]" : "bg-slate-800 border-slate-600 hover:border-cyan-400 hover:bg-slate-700";
                
                return `
                    <button onclick="handleEvidenceMatch('${item.id}')" ${state.matchedEvidence ? 'disabled' : ''} class="${baseClass} ${activeClass}">
                        <span class="text-2xl">${item.icon}</span>
                        <span class="font-bold">${item.text}</span>
                        ${isMatch ? `<span class="ml-auto text-green-400">${icons.check}</span>` : ''}
                    </button>
                `;
            }).join('');

            div.innerHTML = `
                <div class="mb-6 border-l-4 border-cyan-500 pl-4">
                    <h2 class="text-xl font-bold text-white flex items-center gap-2">${icons.search} 1. ç¾å ´æŒ‡èªï¼ˆå®šç¾©ï¼‰</h2>
                    <p class="text-slate-400 text-sm">è«‹å°‡å·¦å´çš„ã€Œå¿ƒæƒ…ã€èˆ‡å³å´æ­£ç¢ºçš„ã€Œç‹€æ…‹ã€é€£ç·šã€‚</p>
                </div>
                <div class="flex-1 flex flex-col md:flex-row items-center justify-center gap-8 md:gap-20">
                    ${leftCard}
                    <div class="hidden md:block text-slate-600">${icons.arrowRight}</div>
                    <div class="w-full md:w-1/3">${options}</div>
                </div>
            `;
            container.appendChild(div);
        }

        function renderMotive(container) {
            const div = document.createElement('div');
            div.className = 'h-full flex flex-col slide-in';

            const opts = [
                { id: 'toy', title: 'A. æ˜¯ï¼Œç©å…·å¾ˆé‡è¦', desc: 'å› ç‚ºé‚£å€‹ç©å…·éå¸¸æ˜‚è²´ï¼Œä¸èƒ½å¼„ä¸Ÿã€‚' },
                { id: 'love', title: 'B. ä¸æ˜¯ï¼Œæ˜¯å› ç‚ºæ„Ÿè¦ºå¤±å»äº†æ„›', desc: 'å¥¹è¦ºå¾—å¤±å»äº†åª½åª½çš„æ„›å’Œå…¬å¹³ï¼Œå¿ƒè£¡è¦ºå¾—ç©ºç©ºçš„ã€‚' }
            ].map(item => {
                const isSelected = state.selectedMotive === item.id;
                const style = isSelected 
                    ? (item.id === 'toy' ? 'border-red-400 bg-red-900/20' : 'border-cyan-400 bg-cyan-900/20 shadow-[0_0_15px_rgba(34,211,238,0.1)]')
                    : 'border-slate-600 bg-slate-800 hover:bg-slate-700';
                
                return `
                    <button onclick="state.selectedMotive='${item.id}'; render();" class="p-5 rounded-xl border-2 text-left transition-all w-full mb-4 ${style}">
                        <div class="font-bold text-lg mb-1">${item.title}</div>
                        <div class="text-sm text-slate-400">${item.desc}</div>
                    </button>
                `;
            }).join('');

            div.innerHTML = `
                <div class="mb-6 border-l-4 border-cyan-500 pl-4">
                    <h2 class="text-xl font-bold text-white flex items-center gap-2">${icons.fileText} 2. è­‰è©åˆ†æï¼ˆåŸå› ï¼‰</h2>
                    <p class="text-slate-400 text-sm">æ·±å…¥èª¿æŸ¥å°æ¨‚çš„å…§å¿ƒï¼Œå¥¹ç‚ºä»€éº¼æœƒæ„Ÿåˆ°å¤±è½ï¼Ÿ</p>
                </div>
                <div class="flex-1 flex flex-col md:flex-row items-stretch gap-6">
                    <div class="md:w-1/3 bg-slate-800 border border-slate-600 rounded-2xl p-6 flex flex-col items-center text-center">
                        <div class="w-24 h-24 bg-purple-900/50 rounded-full border-2 border-purple-400 mb-4 flex items-center justify-center text-3xl">ğŸ‘§</div>
                        <div class="bg-slate-900/80 p-4 rounded-xl border border-slate-700 w-full">
                            <p class="text-purple-200 font-bold mb-2">åµæ¢æå•ï¼š</p>
                            <p class="text-slate-300 text-sm leading-relaxed">ã€Œå°æ¨‚æ˜¯å› ç‚ºã€ç©å…·è¢«æ¶èµ°ã€é€™å€‹ç‰©å“æœ¬èº«çš„æå¤±æ‰æ„Ÿåˆ°é€™éº¼é›£éå—ï¼Ÿã€</p>
                        </div>
                    </div>
                    <div class="flex-1 flex flex-col justify-center">
                        ${opts}
                        <button onclick="handleMotiveSubmit()" ${!state.selectedMotive ? 'disabled' : ''} class="mt-4 py-3 bg-cyan-600 hover:bg-cyan-500 disabled:bg-slate-700 disabled:text-slate-500 text-white font-bold rounded-xl transition-all">
                            æäº¤åˆ†æå ±å‘Š
                        </button>
                    </div>
                </div>
            `;
            container.appendChild(div);
        }

        function renderScan(container) {
            const div = document.createElement('div');
            div.className = 'h-full flex flex-col slide-in';

            const opts = [
                { id: 'heavy', text: 'èº«é«”é‡é‡çš„ï¼ˆåƒç©¿è‘—æ¿•è¡£æœï¼‰', icon: 'ğŸ§¥' },
                { id: 'hot', text: 'èº«é«”ç†±ç†±çš„ï¼ˆåƒç«åœ¨ç‡’ï¼‰', icon: 'ğŸ”¥' },
                { id: 'tight', text: 'èƒ¸å£æ‚¶æ‚¶çš„ï¼ˆåƒå¡äº†å¤§çŸ³é ­ï¼‰', icon: 'ğŸª¨' },
                { id: 'sore', text: 'çœ¼ç›é…¸é…¸çš„ï¼ˆçœ¼æ·šå¿«æ‰ä¸‹ä¾†ï¼‰', icon: 'ğŸ¥º' }
            ].map(item => {
                const isSelected = state.bodySymptoms.includes(item.id);
                const style = isSelected ? 'bg-cyan-900/40 border-cyan-400 text-cyan-100' : 'bg-slate-800 border-slate-600 hover:bg-slate-700';
                const checkStyle = isSelected ? 'border-cyan-400 bg-cyan-500' : 'border-slate-500';
                
                return `
                    <button onclick="toggleBodySymptom('${item.id}')" class="p-4 rounded-xl border-2 text-left flex items-center gap-4 transition-all ${style}">
                        <div class="w-6 h-6 rounded border-2 flex items-center justify-center ${checkStyle}">
                            ${isSelected ? `<span class="text-white">${icons.check}</span>` : ''}
                        </div>
                        <span class="text-2xl">${item.icon}</span>
                        <span class="font-bold">${item.text}</span>
                    </button>
                `;
            }).join('');

            // ç°¡åŒ–çš„äººé«” SVG
            const bodySvg = `
                <svg viewBox="0 0 100 200" class="w-full h-full drop-shadow-[0_0_10px_rgba(34,211,238,0.5)]">
                    <path d="M50 10 C50 10 35 10 35 25 C35 35 40 40 40 40 L30 50 L20 100 L30 110 L40 60 L40 120 L30 190 L45 190 L45 130 L55 130 L55 190 L70 190 L60 120 L60 60 L70 110 L80 100 L70 50 L60 40 C60 40 65 35 65 25 C65 10 50 10 50 10" fill="none" stroke="#22d3ee" stroke-width="2" />
                    ${state.bodySymptoms.includes('sore') ? '<circle cx="43" cy="20" r="2" fill="#ef4444" class="pulse-slow" /><circle cx="57" cy="20" r="2" fill="#ef4444" class="pulse-slow" />' : ''}
                    ${state.bodySymptoms.includes('tight') ? '<circle cx="50" cy="55" r="8" fill="#ef4444" opacity="0.5" />' : ''}
                    ${state.bodySymptoms.includes('heavy') ? '<rect x="30" y="50" width="40" height="80" fill="#3b82f6" opacity="0.2" />' : ''}
                    ${state.bodySymptoms.includes('hot') ? '<rect x="30" y="50" width="40" height="80" fill="#ef4444" opacity="0.2" />' : ''}
                </svg>
            `;

            div.innerHTML = `
                <div class="mb-4 border-l-4 border-cyan-500 pl-4">
                    <h2 class="text-xl font-bold text-white flex items-center gap-2">${icons.activity} 3. èº«é«”æƒææ©Ÿï¼ˆåæ‡‰ï¼‰</h2>
                    <p class="text-slate-400 text-sm">å•Ÿå‹•ç”Ÿç‰©æƒæã€‚è«‹å‹¾é¸å‡ºã€Œå¤±è½ã€æ™‚æœƒæœ‰çš„èº«é«”åæ‡‰ï¼ˆå¯è¤‡é¸ï¼‰ã€‚</p>
                </div>
                <div class="flex-1 flex flex-col md:flex-row items-center gap-8">
                    <div class="relative w-48 h-96 flex-shrink-0">
                        <div class="absolute inset-0 bg-cyan-500/10 rounded-full blur-xl animate-pulse"></div>
                        ${bodySvg}
                    </div>
                    <div class="flex-1 grid grid-cols-1 gap-3 w-full">
                        ${opts}
                        <button onclick="handleScanSubmit()" ${state.bodySymptoms.length === 0 ? 'disabled' : ''} class="mt-4 py-3 bg-cyan-600 hover:bg-cyan-500 disabled:bg-slate-700 disabled:text-slate-500 text-white font-bold rounded-xl transition-all">
                            å®Œæˆæƒæ
                        </button>
                    </div>
                </div>
            `;
            container.appendChild(div);
        }

        function renderTactics(container) {
            const div = document.createElement('div');
            div.className = 'h-full flex flex-col slide-in';

            const opts = [
                { id: 'pretend', text: 'å‡è£æ²’äº‹ï¼Œè¶•å¿«å»è®€æ›¸', icon: 'ğŸ“š', type: 'bad' },
                { id: 'hide', text: 'æ‰¾å€‹èˆ’æœçš„è§’è½èº²ä¸€ä¸‹', icon: 'ğŸ§¸', type: 'good' },
                { id: 'talk', text: 'æ‰¾ä¿¡ä»»çš„äººèªªèªªè©±', icon: 'ğŸ—£ï¸', type: 'good' },
                { id: 'cry', text: 'å¤§å“­ä¸€å ´ä¹Ÿæ²’é—œä¿‚', icon: 'ğŸ˜­', type: 'good' }
            ].map(item => {
                const isSelected = state.selectedTactics.includes(item.id);
                const style = isSelected ? 'bg-purple-900/40 border-purple-400 text-purple-100 shadow-[0_0_15px_rgba(192,132,252,0.2)]' : 'bg-slate-800 border-slate-600 hover:bg-slate-700';
                const checkStyle = isSelected ? 'border-purple-400 bg-purple-500' : 'border-slate-500';
                
                return `
                    <button onclick="toggleTactic('${item.id}')" class="p-6 rounded-2xl border-2 text-left flex items-start gap-4 transition-all hover:scale-105 active:scale-95 ${style}">
                         <div class="mt-1 w-6 h-6 rounded-full border-2 flex items-center justify-center flex-shrink-0 ${checkStyle}">
                           ${isSelected ? `<span class="text-white">${icons.check}</span>` : ''}
                         </div>
                         <div>
                            <div class="text-3xl mb-2">${item.icon}</div>
                            <div class="font-bold text-lg">${item.text}</div>
                         </div>
                    </button>
                `;
            }).join('');

            div.innerHTML = `
                 <div class="mb-6 border-l-4 border-cyan-500 pl-4">
                    <h2 class="text-xl font-bold text-white flex items-center gap-2">${icons.shield} 4. çµ•æ‹›æ¼”ç·´ï¼ˆè§£æ±ºå•é¡Œï¼‰</h2>
                    <p class="text-slate-400 text-sm">å¦‚æœå¿ƒè£¡ä¸‹äº†è—è‰²çš„é›¨ï¼Œæ–‡ç« æ•™æˆ‘å€‘å¯ä»¥æ€éº¼åšï¼Ÿï¼ˆå¯è¤‡é¸ï¼‰</p>
                </div>
                <div class="flex-1 grid grid-cols-1 md:grid-cols-2 gap-4">
                    ${opts}
                </div>
                 <button onclick="handleTacticsSubmit()" ${state.selectedTactics.length === 0 ? 'disabled' : ''} class="mt-6 w-full py-4 bg-purple-600 hover:bg-purple-500 disabled:bg-slate-700 text-white font-bold rounded-xl transition-all shadow-lg text-lg flex items-center justify-center gap-2">
                    ${icons.shield} åŸ·è¡Œæˆ°è¡“
                </button>
            `;
            container.appendChild(div);
        }

        function renderReport(container) {
            const div = document.createElement('div');
            div.className = 'h-full flex flex-col items-center justify-center text-center zoom-in';

            div.innerHTML = `
                <div class="w-32 h-32 bg-green-500 rounded-full flex items-center justify-center mb-6 shadow-[0_0_50px_rgba(34,197,94,0.5)]">
                    <div class="text-white scale-[2]">${icons.check}</div>
                </div>
                <h1 class="text-4xl font-black text-white mb-4">æ¡ˆä»¶é †åˆ©åµç ´ï¼</h1>
                <div class="bg-slate-800 p-6 rounded-2xl border border-slate-600 max-w-lg w-full mb-8">
                    <h3 class="text-cyan-400 font-bold mb-4 uppercase tracking-widest border-b border-slate-700 pb-2">Case Summary</h3>
                    <ul class="text-left space-y-3 text-slate-300">
                        <li class="flex gap-2"><span class="text-green-500 mt-1">${icons.check}</span> <span>å®šç¾©ï¼šå¤±è½å°±åƒã€Œæ¼æ°£çš„è¼ªèƒã€ï¼Œè®“äººæ²’åŠ›æ°£ã€‚</span></li>
                        <li class="flex gap-2"><span class="text-green-500 mt-1">${icons.check}</span> <span>åŸå› ï¼šä¸åªæ˜¯ç©å…·ï¼Œè€Œæ˜¯æ„Ÿè¦ºå¤±å»äº†ã€Œæ„›ã€ã€‚</span></li>
                        <li class="flex gap-2"><span class="text-green-500 mt-1">${icons.check}</span> <span>åæ‡‰ï¼šèº«é«”æœƒé‡é‡çš„ã€çœ¼ç›é…¸é…¸çš„ã€èƒ¸å£æ‚¶æ‚¶çš„ã€‚</span></li>
                        <li class="flex gap-2"><span class="text-green-500 mt-1">${icons.check}</span> <span>å°ç­–ï¼šèº²ä¸€ä¸‹ã€èªªèªªè©±ã€å“­ä¸€å ´ï¼Œéƒ½æ˜¯å¾ˆå¥½çš„æ–¹æ³•ï¼</span></li>
                    </ul>
                </div>
                <button onclick="restartGame()" class="px-8 py-3 text-slate-400 hover:text-white font-bold transition-colors flex items-center gap-2">
                    ${icons.refresh} é‡å•Ÿèª¿æŸ¥
                </button>
            `;
            container.appendChild(div);
        }

        // --- 4. å•Ÿå‹• ---
        render();

    </script>
</body>
</html>
